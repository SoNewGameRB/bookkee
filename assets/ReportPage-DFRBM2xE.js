import{r as n,h as c,o as S,y as _,c as i,b as t,j as B,v as V,k as j,a as d,q as A,g as r}from"./index-CMD9G3lJ.js";import{C as E,p as O}from"./chartjs-plugin-datalabels.esm-Di9atHb7.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"report-container"},T={class:"filter-box"},U={class:"filter-box"},P={class:"filter-box"},$={class:"charts"},q={key:0,class:"chart-box"},z={key:0},J={key:1},W={class:"chart-box"},G={key:0},H={class:"chart-box"},K={key:0},L={__name:"ReportPage",setup(Q){const p=n(null),b=n(null),f=n(null),R=n([]),v=n(new Date().toISOString().slice(0,7)),l=n("combined"),u=n("pie");let m=null,y=null,g=null;const C=c(()=>R.value.filter(a=>a.date.startsWith(v.value))),h=c(()=>{const a={};return C.value.forEach(e=>{e.category==="expense"&&(a[e.subCategory]=(a[e.subCategory]||0)+e.amount)}),a}),k=c(()=>{const a={};return C.value.forEach(e=>{e.category==="income"&&(a[e.subCategory]=(a[e.subCategory]||0)+e.amount)}),a}),F=c(()=>{const a={};return C.value.forEach(e=>{const s=`${e.category==="income"?"收入":"支出"} - ${e.subCategory}`;a[s]=(a[s]||0)+e.amount}),a}),x=a=>Object.keys(a).length===0,o=async()=>{await A(),m&&m.destroy(),y&&y.destroy(),g&&g.destroy();const a={plugins:{datalabels:{color:"black",font:{weight:"bold",size:14},formatter:(e,s)=>{const w=s.dataset.data.reduce((D,M)=>D+M,0);return(e/w*100).toFixed(1)+"%"}}}};(l.value==="combined"||l.value==="all")&&p.value&&(m=new E(p.value,{type:u.value,data:{labels:Object.keys(F.value),datasets:[{data:Object.values(F.value),backgroundColor:["#4BC0C0","#FF6384","#36A2EB","#FF9F40","#FFCD56"]}]},options:a,plugins:[O]})),(l.value==="separate"||l.value==="all")&&b.value&&(y=new E(b.value,{type:u.value,data:{labels:Object.keys(h.value),datasets:[{data:Object.values(h.value),backgroundColor:["#FF6384","#FF9F40","#FFCD56","#4BC0C0","#36A2EB"]}]},options:a,plugins:[O]})),(l.value==="separate"||l.value==="all")&&f.value&&(g=new E(f.value,{type:u.value,data:{labels:Object.keys(k.value),datasets:[{data:Object.values(k.value),backgroundColor:["#42A5F5","#66BB6A","#FFEB3B","#9E9E9E"]}]},options:a,plugins:[O]}))};return S(()=>{const a=localStorage.getItem("records");a&&(R.value=JSON.parse(a)),o()}),_(v,o),_(l,o),_(u,o),(a,e)=>(r(),i("div",N,[e[11]||(e[11]=t("h2",null,"📊 收支類別統計",-1)),t("div",T,[e[3]||(e[3]=t("label",null,"📅 選擇月份：",-1)),B(t("input",{type:"month","onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),onChange:o,class:"input-field"},null,544),[[V,v.value]])]),t("div",U,[e[5]||(e[5]=t("label",null,"📊 顯示模式：",-1)),B(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),onChange:o,class:"input-field"},e[4]||(e[4]=[t("option",{value:"combined"},"混合模式",-1),t("option",{value:"separate"},"分開模式",-1),t("option",{value:"all"},"同時顯示",-1)]),544),[[j,l.value]])]),t("div",P,[e[7]||(e[7]=t("label",null,"📊 圖表類型：",-1)),B(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>u.value=s),onChange:o,class:"input-field"},e[6]||(e[6]=[t("option",{value:"pie"},"圓餅圖",-1),t("option",{value:"bar"},"長條圖",-1)]),544),[[j,u.value]])]),t("div",$,[l.value==="combined"||l.value==="all"?(r(),i("div",q,[e[8]||(e[8]=t("h3",null,"🔄 收支整體比例",-1)),t("canvas",{ref_key:"combinedChartRef",ref:p},null,512),x(F.value)?(r(),i("p",z,"⚠️ 沒有資料可顯示")):d("",!0)])):d("",!0),l.value==="separate"||l.value==="all"?(r(),i("div",J,[t("div",W,[e[9]||(e[9]=t("h3",null,"💰 支出類別比例",-1)),t("canvas",{ref_key:"expenseChartRef",ref:b},null,512),x(h.value)?(r(),i("p",G,"⚠️ 沒有支出資料")):d("",!0)]),t("div",H,[e[10]||(e[10]=t("h3",null,"💵 收入類別比例",-1)),t("canvas",{ref_key:"incomeChartRef",ref:f},null,512),x(k.value)?(r(),i("p",K,"⚠️ 沒有收入資料")):d("",!0)])])):d("",!0)])]))}},ee=I(L,[["__scopeId","data-v-5bd3b750"]]);export{ee as default};
